---
trigger: manual
---
首先你有这个项目的编辑权限，不要只告诉我怎么修改，你直接修改即可

# 楷书字库管理项目规则

## 1. 项目概述与架构设计

### 1.1 项目定位
楷书字库管理项目是一个专业的书法字体管理工具，旨在帮助用户轻松建立、管理和使用完整的楷书字库。项目采用现代化的前后端分离架构，前端使用React + Ant Design，后端使用Node.js + Express，数据库采用PostgreSQL。neon的数据库。后期该项目要打包成跨平台应用，主打手机端软件和电脑端程序。

### 1.2 技术架构
- **前端框架**: React 18 + Hooks + React Router v6
- **UI组件库**: Ant Design 4.x
- **状态管理**: React Context API
- **构建工具**: Vite
- **后端框架**: Node.js + Express
- **数据库**: PostgreSQL Neon提供
- **OCR引擎**: Tesseract.js 和第三方api
- **图像处理**: Sharp.js
- **部署平台**: Vercel + NeonDB + github

### 1.3 项目结构
```
kaishu/
├── backend/              # 后端服务
├── frontend/             # 前端应用
│   ├── src/
│   │   ├── components/   # React组件
│   │   ├── App.jsx       # 应用入口
│   │   └── main.jsx      # 渲染入口
├── 楷书库/               # 图像资源目录，只是本地测试的，部署网站后上传到网站资源文件夹
├── tools/                # 工具脚本
└── public/               # 静态资源
```

## 2. 设计原则与用户体验

### 2.1 现代化设计语言
- **极简主义**: 采用"少即是多"的设计理念，界面元素简洁明了
- **一致性**: 统一的视觉语言和交互模式贯穿整个应用
- **响应式**: 完整支持桌面端和移动端设备
- **无障碍**: 遵循WCAG 2.1标准，确保可访问性

### 2.2 主题系统
- **双主题支持**: 明亮模式和暗黑模式自动切换
- **主题变量**: 使用CSS变量管理主题色，便于扩展
- **动态适配**: 组件根据主题自动调整样式

### 2.3 交互设计
- **键盘导航**: 支持完整的键盘操作（Ctrl+K搜索等）
- **即时反馈**: 操作结果通过消息提示即时反馈
- **渐进式加载**: 大型内容使用骨架屏和加载状态
- **错误恢复**: 提供清晰的错误信息和恢复路径

## 3. 核心功能模块规范

### 3.1 作品上传模块
- **文件处理**: 支持多种图像格式（JPG/PNG/GIF/WebP）
- **中文文件名**: 完整支持中文文件名的上传和显示
- **元数据管理**: 支持作品描述、作者、标签、分组等信息
- **OCR集成**: 自动识别单字符或多字符作品并生成标注

### 3.2 字体标注模块
- **双模式标注**: 
  - 矩形框选模式：适用于规则排列的字符
  - 四点定位模式：适用于透视变形的字符
- **实时预览**: 标注区域实时高亮显示
- **透视校正**: 支持四点坐标透视变换预览
- **批量操作**: 支持批量标注和批量删除

### 3.3 作品展示模块
- **网格布局**: 响应式网格展示所有作品
- **详情视图**: 单作品详情页展示原图和标注字符
- **导航控制**: 左右箭头快速切换作品
- **标注预览**: 裁剪后的字符图像展示

### 3.4 字符搜索模块
- **智能搜索**: 支持汉字、拼音首字母、全拼搜索
- **搜索历史**: 本地存储最近10条搜索记录
- **热门推荐**: 展示常用搜索词
- **结果展示**: 网格布局展示搜索结果，支持跳转到作品

### 3.5 字体统计模块
- **Unicode覆盖**: 统计各Unicode区间的字符覆盖率
- **频率分析**: 展示字符使用频率排行
- **缺失补全**: 显示未标注的常用字符
- **导出功能**: 支持统计数据导出

### 3.6 管理后台模块
- **用户管理**: 用户增删改查、权限分配
- **内容编辑**: 首页内容动态配置
- **评论设置**: 评论功能开关和配置
- **系统监控**: 标注数量统计、系统状态

## 4. 技术实现规范

### 4.1 前端实现
- **组件化**: 高内聚低耦合的组件设计，可以把相同的样式组件化，优先使用ant design的样式
- **状态管理**: 使用React Context进行全局状态管理
- **路由管理**: React Router v6实现SPA应用
- **性能优化**: 
  - 图像懒加载
  - 组件记忆化（React.memo）
  - 虚拟滚动（长列表）
  - 代码分割（动态导入）

### 4.2 后端实现
- **RESTful API**: 遵循RESTful设计原则
- **错误处理**: 统一的错误响应格式
- **安全机制**: 
  - JWT令牌认证
  - CORS策略
  - 输入验证和清理
- **数据库优化**: 
  - 连接池管理
  - 查询重试机制
  - 索引优化

### 4.3 图像处理
- **裁剪引擎**: Sharp.js实现高性能图像处理
- **缓存机制**: 图像裁剪结果缓存
- **格式支持**: 支持主流图像格式
- **质量控制**: 可调节的JPEG压缩质量
- canvas技术裁剪图片

### 4.4 OCR处理
- **引擎选择**: 百度OCR作为OCR引擎
- **模式优化**: 针对书法作品优化识别参数
- **结果处理**: 智能过滤和去重算法
- **网格扫描**: 自适应网格识别复杂布局

## 5. 性能与安全规范

### 5.1 性能优化
- **前端优化**:
  - 首屏加载优化
  - 图像懒加载
  - 组件按需渲染
  - 本地缓存策略
- **后端优化**:
  - 数据库连接池
  - 查询结果缓存
  - 响应压缩
  - CDN静态资源

### 5.2 安全规范
- **认证安全**: 
  - JWT令牌机制
  - 密码加密存储（bcrypt）
  - 会话管理
- **数据安全**:
  - 环境变量管理敏感信息
  - SQL注入防护
  - XSS防护
  - 文件上传安全检查
- **传输安全**: HTTPS全站加密

## 6. 测试与部署规范

### 6.1 测试策略
- **单元测试**: 关键组件和函数的单元测试
- **集成测试**: API端点集成测试
- **端到端测试**: 用户流程的端到端测试
- **性能测试**: 关键路径性能基准测试

### 6.2 部署流程
- **持续集成**: GitHub Actions自动化构建和测试
- **环境管理**: 开发、测试、生产环境分离
- **版本控制**: 语义化版本控制（SemVer）
- **回滚机制**: 部署失败时的自动回滚

## 7. 代码质量与维护

### 7.1 代码规范
- **命名规范**: 
  - 文件名：大驼峰命名法（PascalCase）
  - 变量/函数：小驼峰命名法（camelCase）
  - 常量：全大写加下划线（UPPER_CASE）
  - CSS类名：连字符命名法（kebab-case）
- **注释规范**: 
  - 组件顶部添加功能描述
  - 复杂逻辑添加行内注释
  - API接口添加参数和返回值说明
- **代码格式**: 
  - 2空格缩进
  - 行宽限制100字符
  - 语句末尾不加分号

### 7.2 维护规范
- **文档更新**: 功能变更时同步更新文档
- **依赖管理**: 定期更新依赖包，修复安全漏洞
- **监控告警**: 关键指标监控和异常告警
- **用户反馈**: 建立用户反馈收集和处理机制

## 8. 未来发展方向

### 8.1 功能扩展
- **AI增强**: 集成更先进的AI模型提升OCR准确率
- **协作功能**: 多用户协作标注和管理
- **导出功能**: 支持字体文件导出（TTF/OTF）
- **API开放**: 提供开放API供第三方集成

### 8.2 技术升级
- **微前端**: 拆分为微前端架构提升可维护性
- **服务端渲染**: 引入SSR提升首屏性能
- **PWA支持**: 支持离线使用和安装到桌面
- **WebAssembly**: 关键算法使用WebAssembly提升性能

### 8.3 用户体验优化
- **个性化**: 用户界面个性化配置
- **智能推荐**: 基于使用习惯的智能推荐
- **语音交互**: 语音搜索和控制功能
- **多语言**: 国际化支持多语言界面

---
*本规则文档旨在为楷书字库管理项目的开发、维护和扩展提供全面的指导规范，确保项目在技术先进性、用户体验和代码质量方面持续提升。*